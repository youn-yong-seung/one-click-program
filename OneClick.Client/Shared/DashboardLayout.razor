@using Microsoft.AspNetCore.Components.Routing
@inherits LayoutComponentBase
@implements IDisposable
@inject NavigationManager Nav
@inject OneClick.Client.Services.TokenService TokenService

<div class="flex h-screen bg-gray-900 text-white font-sans selection:bg-indigo-500 selection:text-white">
    <!-- Main Sidebar -->
    <aside class="w-64 bg-gray-900 flex flex-col border-r border-gray-800 flex-shrink-0">
        <!-- Sidebar Header -->
        <div class="h-16 flex items-center px-6 border-b border-gray-800">
            <i class="fa-solid fa-layer-group text-indigo-500 text-xl mr-3"></i>
            <span class="text-xl font-bold tracking-tight">OneClick</span>
        </div>
        
        <!-- Sidebar Navigation -->
        <nav class="flex-1 px-4 py-6 space-y-2 overflow-y-auto dark-scrollbar">
            <NavLink class="flex items-center px-4 py-3 text-gray-300 rounded-lg hover:bg-gray-800 hover:text-white transition-colors group" ActiveClass="bg-gray-800 text-white shadow-inner" href="/dashboard/home" Match="NavLinkMatch.All">
                <div class="flex-shrink-0 w-6 text-center">
                    <i class="fa-solid fa-house group-hover:text-indigo-400 transition-colors"></i>
                </div>
                <span class="ml-3 font-medium">홈</span>
            </NavLink>

            <NavLink class="flex items-center px-4 py-3 text-gray-300 rounded-lg hover:bg-gray-800 hover:text-white transition-colors group" ActiveClass="bg-gray-800 text-white shadow-inner" href="/dashboard/library">
                <div class="flex-shrink-0 w-6 text-center">
                    <i class="fa-solid fa-layer-group group-hover:text-indigo-400 transition-colors"></i>
                </div>
                <span class="ml-3 font-medium">라이브러리</span>
            </NavLink>
            
            <NavLink class="flex items-center px-4 py-3 text-gray-300 rounded-lg hover:bg-gray-800 hover:text-white transition-colors group" ActiveClass="bg-gray-800 text-white shadow-inner" href="/dashboard/subscription">
                <div class="flex-shrink-0 w-6 text-center">
                    <i class="fa-solid fa-credit-card group-hover:text-pink-400 transition-colors"></i>
                </div>
                <span class="ml-3 font-medium">구독 및 결제</span>
            </NavLink>
        </nav>

        <!-- Sidebar Footer (User Account) -->
        <div class="p-4 border-t border-gray-800">
            <div class="flex items-center gap-3 p-3 rounded-lg cursor-pointer hover:bg-gray-800 transition-colors group" @onclick='() => Nav.NavigateTo("/dashboard/settings")'>
                <div class="w-10 h-10 rounded-full bg-indigo-500 flex items-center justify-center text-white font-bold text-lg shadow-md group-hover:bg-indigo-400 transition-colors">
                    <i class="fa-solid fa-user"></i>
                </div>
                <div class="flex-1 min-w-0">
                    <p class="text-sm font-medium text-white truncate">내 계정</p>
                    <p class="text-xs text-gray-400 truncate">설정 및 보안</p>
                </div>
                <i class="fa-solid fa-chevron-right text-gray-500 text-xs group-hover:text-white transition-colors"></i>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 bg-gray-50 flex flex-col min-w-0 overflow-hidden relative">
        <div class="flex-1 overflow-auto focus:outline-none">
            @Body
        </div>
    </main>
</div>

@code {
    protected override void OnInitialized()
    {
        TokenService.LogoutRequested += OnLogout;
    }

    private void OnLogout()
    {
        InvokeAsync(() => 
        {
            Nav.NavigateTo("/", forceLoad: true);
        });
    }

    public void Dispose()
    {
        TokenService.LogoutRequested -= OnLogout;
    }
}
